<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Customize - Orbitly Chat</title>
<script src="https://cdn.tailwindcss.com"></script>
<!-- Massive Google Fonts Import -->
<link href="https://fonts.googleapis.com/css2?family=Abril+Fatface&family=Architects+Daughter&family=Audiowide&family=Bad+Script&family=Bangers&family=Barrio&family=Berkshire+Swash&family=Bevan&family=Big+Shoulders+Display:wght@700&family=Black+And+White+Picture&family=Black+Ops+One&family=Bonbon&family=Bowlby+One+SC&family=Bungee+Inline&family=Bungee+Shade&family=Cabin+Sketch:wght@700&family=Caesar+Dressing&family=Caveat:wght@700&family=Chakra+Petch:wght@700&family=Chicle&family=Cinzel:wght@700&family=Codystar:wght@800&family=Comfortaa:wght@700&family=Comic+Neue:wght@700&family=Cookie&family=Covered+By+Your+Grace&family=Creepster&family=Darker+Grotesque:wght@900&family=Dela+Gothic+One&family=Diplomata&family=DM+Serif+Display&family=DotGothic16&family=Eater&family=El+Messiri:wght@700&family=Emilys+Candy&family=Ewert&family=Fascinate+Inline&family=Faster+One&family=Fauna+One&family=Finger+Paint&family=Flamenco:wght@700&family=Fontdiner+Swanky&family=Fredoka+One&family=Frijole&family=Fruktur&family=Galindo&family=Glass+Antiqua&family=Gloria+Hallelujah&family=Gochi+Hand&family=Grandstander:wght@900&family=Grenze+Gotisch:wght@700&family=Griffy&family=Handjet:wght@700&family=Henny+Penny&family=Homemade+Apple&family=Iceberg&family=Inconsolata:wght@700&family=Indie+Flower&family=Irish+Grover&family=Jacques+Francois+Shadow&family=Jolly+Lodger&family=Josefin+Sans:wght@700&family=Just+Me+Again+Down+Here&family=Kavoon&family=Kranky&family=Krona+One&family=Kumar+One+Outline&family=Lakki+Reddy&family=Lato:wght@700&family=Lemon&family=Libre+Barcode+39+Text&family=Limelight&family=Lobster&family=Long+Cang&family=Love+Ya+Like+A+Sister&family=Luckiest+Guy&family=Major+Mono+Display&family=MedievalSharp&family=Megrim&family=Merriweather:wght@700&family=Metal+Mania&family=Miltonian+Tattoo&family=Modak&family=Monoton&family=Montserrat:wght@700&family=Mountains+of+Christmas:wght@700&family=Mystery+Quest&family=Nanum+Pen+Script&family=New+Rocker&family=Niconne&family=Nosifer&family=Nothing+You+Could+Do&family=Nova+Cut&family=Nova+Mono&family=Nova+Oval&family=Nova+Script&family=Nova+Square&family=Nunito:wght@700&family=Offside&family=Oldenburg&family=Oleo+Script:wght@700&family=Open+Sans:wght@700&family=Orbitron:wght@700&family=Oregano&family=Oswald:wght@700&family=Pacifico&family=Parisienne&family=Patrick+Hand&family=Permanent+Marker&family=Piedra&family=Pirata+One&family=Playball&family=Playfair+Display:wght@700&family=Poiret+One&family=Poller+One&family=Press+Start+2P&family=Purple+Purse&family=Quicksand:wght@700&family=Racing+Sans+One&family=Raleway:wght@700&family=Ranchers&family=Red+Rose:wght@700&family=Reenie+Beanie&family=Revalia&family=Ribeye+Marrow&family=Righteous&family=Roboto:wght@700&family=Rock+Salt&family=Rubik+Beastly&family=Rubik+Burned&family=Rubik+Distressed&family=Rubik+Gemstones&family=Rubik+Glitch&family=Rubik+Iso&family=Rubik+Marker+Hatch&family=Rubik+Microbe&family=Rubik+Moonrocks&family=Rubik+Puddles&family=Rubik+Wet+Paint&family=Rye&family=Sacramento&family=Saira+Stencil+One&family=Sancreek&family=Sansita+Swashed:wght@900&family=Sarina&family=Satisfy&family=Schoolbell&family=Sedgwick+Ave+Display&family=Shadows+Into+Light&family=Shojumaru&family=Sigmar+One&family=Slackey&family=Smokum&family=Snowburst+One&family=Special+Elite&family=Spicy+Rice&family=Squada+One&family=Stalinist+One&family=Supermercado+One&family=Syncopate:wght@700&family=Tangerine:wght@700&family=Teko:wght@700&family=Titan+One&family=Trade+Winds&family=Turret+Road:wght@800&family=Ubuntu:wght@700&family=Ultra&family=UnifrakturMaguntia&family=Vampiro+One&family=Vast+Shadow&family=VT323&family=Wallpoet&family=Walter+Turncoat&family=Warnes&family=Wire+One&family=Yellowtail&family=Yeseva+One&family=Yesteryear&family=Zeyada&display=swap" rel="stylesheet">

<style>
/* CSS copied from index.html (Assume full styles are present) */
::-webkit-scrollbar { width: 8px; height: 8px; }
::-webkit-scrollbar-track { background: #2b2d31; }
::-webkit-scrollbar-thumb { background: #1a1b1e; border-radius: 4px; }
::-webkit-scrollbar-thumb:hover { background: #3f4147; }
/* ... Insert all Effect/Font/Theme CSS here ... */
/* For brevity in output, I am using the standard classes. In production, copy the full <style> block from index.html */
    .cust-active { border-color: #5865F2 !important; box-shadow: 0 0 0 2px #5865F2; }
    /* Font classes, Effect classes, Card Themes, List Styles - ALL Must be preserved here for Preview Rendering */
    /* ... */
</style>
</head>
<body class="bg-[#313338] text-gray-100 font-sans antialiased h-screen flex flex-col">

    <!-- Header -->
    <header class="bg-[#2b2d31] border-b border-[#1e1f22] p-4 flex justify-between items-center shadow-lg">
        <div class="flex items-center gap-3">
            <h1 class="text-xl font-bold text-white flex items-center gap-2">
                <svg class="w-6 h-6 text-pink-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" /></svg>
                Appearance Customization
            </h1>
        </div>
        <button onclick="window.location.href='index.html'" class="px-4 py-2 bg-[#5865F2] hover:bg-[#4752c4] text-white rounded font-bold transition flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path></svg> Back to Chat
        </button>
    </header>

    <!-- Main Content -->
    <div class="flex-1 overflow-hidden flex flex-col md:flex-row">
        
        <!-- Left: Previews (Fixed on desktop) -->
        <div class="w-full md:w-1/3 bg-[#202225] p-6 border-b md:border-b-0 md:border-r border-[#1e1f22] flex flex-col gap-8 overflow-y-auto">
            
            <div class="text-center">
                <span class="text-gray-500 text-[10px] uppercase font-bold mb-3 block tracking-widest">Username Preview</span>
                <div class="bg-[#2b2d31] p-8 rounded-lg border border-[#1e1f22] flex items-center justify-center min-h-[100px]">
                    <span id="cust-username-preview" class="text-4xl font-bold">Your Name</span>
                </div>
            </div>

            <div class="text-center">
                <span class="text-gray-500 text-[10px] uppercase font-bold mb-3 block tracking-widest">List Style Preview</span>
                <div class="bg-[#2b2d31] p-4 rounded-lg border border-[#1e1f22]">
                    <div id="cust-list-preview" class="flex items-center gap-3 p-2 rounded transition">
                        <div class="relative">
                            <img src="https://ui-avatars.com/api/?name=U" class="w-8 h-8 rounded-full object-cover">
                            <div class="absolute -bottom-0.5 -right-0.5 w-3.5 h-3.5 border-[3px] border-[#2b2d31] rounded-full bg-green-500"></div>
                        </div>
                        <div class="flex-1 text-left">
                            <div class="text-sm font-medium text-gray-200">Your Name</div>
                            <div class="text-[10px] text-gray-400 uppercase font-bold">Online</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="text-center">
                <span class="text-gray-500 text-[10px] uppercase font-bold mb-3 block tracking-widest">Chat Message Preview</span>
                <div class="bg-[#313338] p-4 rounded-lg border border-[#1e1f22] text-left">
                    <div class="flex gap-2">
                        <div class="w-8 h-8 rounded-full bg-gray-600 flex-shrink-0"></div>
                        <div>
                            <div class="flex items-baseline gap-2">
                                <span class="text-white font-medium text-sm">Your Name</span>
                                <span class="text-[10px] text-gray-400">Today at 12:00</span>
                            </div>
                            <p id="cust-message-preview" class="text-sm leading-relaxed">This is how your messages will look!</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="text-center">
                <span class="text-gray-500 text-[10px] uppercase font-bold mb-3 block tracking-widest">Profile Card Preview</span>
                <div id="cust-card-preview-box" class="p-4 rounded-xl border h-32 flex items-center justify-center relative overflow-hidden transition-all shadow-lg">
                    <div class="text-center z-10">
                        <h4 class="text-white font-bold">Profile Card</h4>
                        <p class="text-white/60 text-xs">Theme Applied</p>
                    </div>
                </div>
            </div>

            <!-- Save Button (Mobile only mainly, but good to have) -->
            <button onclick="app.saveCustomization()" class="w-full py-3 bg-green-600 hover:bg-green-700 text-white font-bold rounded shadow-lg mt-auto">Save All Changes</button>
        </div>

        <!-- Right: Controls -->
        <div class="w-full md:w-2/3 flex flex-col bg-[#313338]">
            <div class="flex border-b border-[#1e1f22] bg-[#2f3136] overflow-x-auto">
                <button onclick="app.switchCustTab('username')" id="cust-tab-username" class="flex-1 min-w-[100px] py-4 text-sm font-bold text-white border-b-2 border-[#5865F2]">Username</button>
                <button onclick="app.switchCustTab('list')" id="cust-tab-list" class="flex-1 min-w-[100px] py-4 text-sm font-bold text-gray-400 hover:text-gray-200">List Style</button>
                <button onclick="app.switchCustTab('messages')" id="cust-tab-messages" class="flex-1 min-w-[100px] py-4 text-sm font-bold text-gray-400 hover:text-gray-200">Messages</button>
                <button onclick="app.switchCustTab('usercard')" id="cust-tab-usercard" class="flex-1 min-w-[100px] py-4 text-sm font-bold text-gray-400 hover:text-gray-200">Profile Card</button>
            </div>

            <div class="flex-1 overflow-y-auto p-6">
                <!-- USERNAME TAB -->
                <div id="cust-view-username" class="space-y-6">
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs uppercase font-bold text-gray-400 mb-2">Base Color</label>
                            <input type="color" id="cust-color" class="w-full h-10 bg-[#202225] rounded cursor-pointer border border-[#1e1f22]">
                        </div>
                        <div>
                            <label class="block text-xs uppercase font-bold text-gray-400 mb-2">Font Family</label>
                            <select id="cust-font" class="w-full px-3 py-2 bg-[#202225] text-white border border-[#1e1f22] rounded outline-none h-10 scrollbar-thin"></select>
                        </div>
                    </div>
                    <div>
                        <label class="block text-xs uppercase font-bold text-gray-400 mb-2">Select Effect</label>
                        <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-2" id="effect-grid"></div>
                    </div>
                </div>

                <!-- LIST STYLE TAB -->
                <div id="cust-view-list" class="space-y-6 hidden">
                    <div>
                        <label class="block text-xs uppercase font-bold text-gray-400 mb-2">Preset Styles</label>
                        <div class="grid grid-cols-2 sm:grid-cols-3 gap-3 mb-4" id="list-style-grid"></div>
                        <button onclick="app.setListStyle('custom')" id="btn-custom-list" class="w-full py-2 bg-[#202225] text-white text-xs font-bold rounded border border-dashed border-gray-600 hover:border-white transition mb-4">Create Your Own (Custom)</button>
                    </div>
                    <div id="custom-list-creator" class="bg-[#202225] p-4 rounded-lg border border-[#1e1f22] hidden">
                        <h4 class="text-white font-bold text-sm mb-3 border-b border-gray-700 pb-2">Custom Creator</h4>
                        <div class="grid grid-cols-3 gap-4">
                            <div><label class="block text-xs uppercase font-bold text-gray-400 mb-2">BG Color</label><input type="color" id="cust-list-bg" class="w-full h-8 bg-transparent rounded cursor-pointer border border-gray-600"></div>
                            <div><label class="block text-xs uppercase font-bold text-gray-400 mb-2">Border</label><input type="color" id="cust-list-border" class="w-full h-8 bg-transparent rounded cursor-pointer border border-gray-600"></div>
                            <div><label class="block text-xs uppercase font-bold text-gray-400 mb-2">Text</label><input type="color" id="cust-list-text" class="w-full h-8 bg-transparent rounded cursor-pointer border border-gray-600"></div>
                        </div>
                    </div>
                </div>

                <!-- MESSAGES TAB -->
                <div id="cust-view-messages" class="space-y-6 hidden">
                    <div class="bg-[#202225] p-4 rounded-lg border border-[#1e1f22]">
                        <h4 class="text-white font-bold text-sm mb-3">Message Style</h4>
                        <div><label class="block text-xs uppercase font-bold text-gray-400 mb-2">Text Color</label><input type="color" id="cust-msg-color" class="w-full h-10 bg-[#1e1f22] rounded cursor-pointer border border-gray-600"></div>
                    </div>
                </div>

                <!-- CARD TAB -->
                <div id="cust-view-usercard" class="space-y-6 hidden">
                    <div><label class="block text-xs uppercase font-bold text-gray-400 mb-2">Card Theme</label><div class="grid grid-cols-2 sm:grid-cols-3 gap-3" id="card-theme-grid"></div></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Container -->
    <div id="toast-container" class="absolute bottom-10 right-10 z-50 pointer-events-none"></div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, updateDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
    
    const firebaseConfig = { apiKey: "AIzaSyBz9yOlQFZQZE-GtGcRbJ2sWUYQTb0kBi4", authDomain: "orbitly-online.firebaseapp.com", projectId: "orbitly-online", storageBucket: "orbitly-online.firebasestorage.app", messagingSenderId: "75415636853", appId: "1:75415636853:web:ccf4ac9c74a1769335a13c", measurementId: "G-9B5458S73M" };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Arrays (Must match index.html logic)
    const allFonts = [{val:'font-default',name:'Default'},{val:'font-abril',name:'Abril Fatface'},{val:'font-architects',name:'Architects'},{val:'font-audiowide',name:'Audiowide'},{val:'font-bangers',name:'Bangers'},{val:'font-barrio',name:'Barrio'},{val:'font-bevan',name:'Bevan'},{val:'font-blackops',name:'Black Ops'},{val:'font-bungee',name:'Bungee'},{val:'font-caveat',name:'Caveat'},{val:'font-chakra',name:'Chakra Petch'},{val:'font-cinzel',name:'Cinzel'},{val:'font-comfortaa',name:'Comfortaa'},{val:'font-comic',name:'Comic Neue'},{val:'font-cookie',name:'Cookie'},{val:'font-creepster',name:'Creepster'},{val:'font-dotgothic',name:'DotGothic'},{val:'font-eater',name:'Eater'},{val:'font-fredoka',name:'Fredoka One'},{val:'font-game',name:'Press Start 2P'},{val:'font-gloria',name:'Gloria'},{val:'font-indie',name:'Indie Flower'},{val:'font-lobster',name:'Lobster'},{val:'font-monoton',name:'Monoton'},{val:'font-orbitron',name:'Orbitron'},{val:'font-pacifico',name:'Pacifico'},{val:'font-permanent',name:'Permanent Marker'},{val:'font-righteous',name:'Righteous'},{val:'font-roboto',name:'Roboto'},{val:'font-rubik',name:'Rubik Glitch'},{val:'font-sacramento',name:'Sacramento'},{val:'font-shadows',name:'Shadows'},{val:'font-special',name:'Special Elite'},{val:'font-vt323',name:'VT323'}];
    const allEffects = [{id:'effect-none',label:'None'},{id:'effect-outline',label:'Outline'},{id:'effect-outline-thick',label:'Bold Outline'},{id:'effect-shadow',label:'Shadow'},{id:'effect-glow',label:'Glow'},{id:'effect-glow-strong',label:'Super Glow'},{id:'effect-3d',label:'3D'},{id:'effect-rainbow',label:'Rainbow'},{id:'effect-gradient-gold',label:'Gold'},{id:'effect-gradient-silver',label:'Silver'},{id:'effect-gradient-fire',label:'Fire'},{id:'effect-gradient-neon',label:'Neon'},{id:'effect-glitch',label:'Glitch'},{id:'effect-neon-blue',label:'Neon Blue'},{id:'effect-matrix',label:'Matrix'},{id:'effect-fire',label:'Real Fire'},{id:'effect-retro-game',label:'8-Bit'}];
    const allListStyles = [{id:'list-style-default',label:'Default'},{id:'list-style-glass',label:'Glass'},{id:'list-style-neon',label:'Neon'},{id:'list-style-gold',label:'Gold'},{id:'list-style-fire',label:'Fire'},{id:'list-style-royal',label:'Royal'},{id:'list-style-outline',label:'Outline'},{id:'list-style-compact',label:'Compact'},{id:'list-style-bubble',label:'Bubble'},{id:'list-style-gameboy',label:'Gameboy'},{id:'list-style-terminal',label:'Terminal'}];
    const allCardThemes = [{id:'card-theme-default',label:'Default'},{id:'card-theme-obsidian',label:'Obsidian'},{id:'card-theme-sunset',label:'Sunset'},{id:'card-theme-ocean',label:'Ocean'},{id:'card-theme-forest',label:'Forest'},{id:'card-theme-gold',label:'Gold'},{id:'card-theme-cyber',label:'Cyberpunk'},{id:'card-theme-matrix',label:'Matrix'},{id:'card-theme-royal',label:'Royal'},{id:'card-theme-galaxy',label:'Galaxy'},{id:'card-theme-minimal',label:'Minimal'},{id:'card-theme-ruby',label:'Ruby'},{id:'card-theme-emerald',label:'Emerald'},{id:'card-theme-holographic',label:'Holographic'},{id:'card-theme-glass',label:'Glass'},{id:'card-theme-outline',label:'Outline'}];

    let currentUser = null;
    let tempCustState = { color:'#ffffff', font:'font-default', effect:'effect-none', listStyle:'list-style-default', cardTheme:'card-theme-default', messageColor:'#dbdee1', customList:{bg:'#2b2d31',border:'#1e1f22',text:'#ffffff'} };

    onAuthStateChanged(auth, async (user) => {
        if(user) {
            currentUser = user;
            const snap = await getDoc(doc(db, "users", user.uid));
            if(snap.exists()) {
                const data = snap.data();
                const style = data.usernameStyle || {};
                tempCustState.color = style.color || '#ffffff';
                tempCustState.font = style.font || 'font-default';
                tempCustState.effect = style.effect || 'effect-none';
                tempCustState.listStyle = data.listStyle || 'list-style-default';
                tempCustState.cardTheme = data.usercardStyle || 'card-theme-default';
                tempCustState.messageColor = (data.messageStyle && data.messageStyle.color) ? data.messageStyle.color : '#dbdee1';
                if(data.customListStyle) tempCustState.customList = data.customListStyle;

                // Populate Inputs
                document.getElementById('cust-color').value = tempCustState.color;
                document.getElementById('cust-msg-color').value = tempCustState.messageColor;
                document.getElementById('cust-list-bg').value = tempCustState.customList.bg;
                document.getElementById('cust-list-border').value = tempCustState.customList.border;
                document.getElementById('cust-list-text').value = tempCustState.customList.text;

                initUI();
                updateCustPreview();
            }
        } else {
            window.location.href = 'index.html';
        }
    });

    function initUI() {
        const fontSel = document.getElementById('cust-font');
        fontSel.innerHTML = allFonts.map(f => `<option value="${f.val}">${f.name}</option>`).join('');
        fontSel.value = tempCustState.font;
        
        document.getElementById('effect-grid').innerHTML = allEffects.map(e => `<button onclick="window.app.setCustEffect('${e.id}')" id="btn-${e.id}" class="p-2 bg-[#1e1f22] border border-gray-700 hover:border-white rounded text-xs text-white ${e.id===tempCustState.effect?'cust-active':''}">${e.label}</button>`).join('');
        document.getElementById('list-style-grid').innerHTML = allListStyles.map(s => `<button onclick="window.app.setListStyle('${s.id}')" id="btn-${s.id}" class="h-10 rounded bg-[#1e1f22] border border-gray-700 hover:border-white text-xs font-bold text-gray-300 ${s.id===tempCustState.listStyle?'cust-active':''}">${s.label}</button>`).join('');
        document.getElementById('card-theme-grid').innerHTML = allCardThemes.map(t => `<button onclick="window.app.setCustCard('${t.id}')" id="btn-${t.id}" class="h-10 rounded bg-[#1e1f22] border border-gray-700 hover:border-white text-xs font-bold text-gray-300 ${t.id===tempCustState.cardTheme?'cust-active':''}">${t.label}</button>`).join('');
        
        // Listeners
        ['cust-color', 'cust-font', 'cust-list-bg', 'cust-list-border', 'cust-list-text', 'cust-msg-color'].forEach(id => document.getElementById(id).addEventListener('input', updateCustPreview));
        
        if (tempCustState.listStyle === 'custom') { document.getElementById('custom-list-creator').classList.remove('hidden'); document.getElementById('btn-custom-list').classList.add('cust-active'); }
    }

    // Styles Helper
    function applyUsernameStyle(el, style) {
        if (!style) return;
        el.className = `font-bold text-4xl ${style.font || 'font-default'}`; el.style.color = ""; el.style.textShadow = ""; el.style.webkitTextStroke = ""; el.removeAttribute('data-text');
        const fx = style.effect || 'effect-none';
        el.classList.add(fx);
        if (['effect-outline', 'effect-outline-thick', 'effect-glow', 'effect-glow-strong', 'effect-emboss', 'effect-inset'].includes(fx)) { el.style.color = style.color; } 
        else if (fx === 'effect-glitch') { el.setAttribute('data-text', el.textContent); el.style.color = style.color; } 
        else if (fx.startsWith('effect-gradient') || fx.startsWith('effect-anim') || fx.startsWith('effect-neon') || fx === 'effect-matrix' || fx === 'effect-fire') {} 
        else { el.style.color = style.color; }
    }

    function updateCustPreview() {
        tempCustState.color = document.getElementById('cust-color').value;
        tempCustState.font = document.getElementById('cust-font').value;
        tempCustState.messageColor = document.getElementById('cust-msg-color').value;

        // Name
        const namePreview = document.getElementById('cust-username-preview');
        namePreview.className = "text-4xl font-bold";
        applyUsernameStyle(namePreview, { color: tempCustState.color, font: tempCustState.font, effect: tempCustState.effect });

        // List
        const listPreview = document.getElementById('cust-list-preview');
        listPreview.style = "";
        if (tempCustState.listStyle === 'custom') {
            tempCustState.customList.bg = document.getElementById('cust-list-bg').value;
            tempCustState.customList.border = document.getElementById('cust-list-border').value;
            tempCustState.customList.text = document.getElementById('cust-list-text').value;
            listPreview.className = "flex items-center gap-3 p-2 rounded hover:brightness-110 transition";
            listPreview.style.backgroundColor = tempCustState.customList.bg;
            listPreview.style.border = `1px solid ${tempCustState.customList.border}`;
            const t = listPreview.querySelector('.text-gray-200'); if(t) { t.style.color = tempCustState.customList.text; t.classList.remove('text-gray-200'); }
        } else {
            listPreview.className = `flex items-center gap-3 p-2 rounded transition ${tempCustState.listStyle}`;
            const t = listPreview.querySelector('.text-sm'); if(t) { t.style.color = ""; t.classList.add('text-gray-200'); }
        }

        // Message
        document.getElementById('cust-message-preview').style.color = tempCustState.messageColor;

        // Card
        document.getElementById('cust-card-preview-box').className = `p-4 rounded-xl border h-32 flex items-center justify-center relative overflow-hidden transition-all shadow-lg ${tempCustState.cardTheme}`;
    }

    window.app = {
        switchCustTab: (tab) => {
            ['username','list','messages','usercard'].forEach(t => {
                document.getElementById(`cust-tab-${t}`).className = `flex-1 min-w-[100px] py-4 text-sm font-bold ${t===tab?'text-white border-b-2 border-[#5865F2]':'text-gray-400 hover:text-gray-200'}`;
                document.getElementById(`cust-view-${t}`).className = t===tab ? 'space-y-6' : 'hidden';
            });
        },
        setCustEffect: (id) => { tempCustState.effect = id; updateCustPreview(); renderSelection('effect-grid', id); },
        setCustCard: (id) => { tempCustState.cardTheme = id; updateCustPreview(); renderSelection('card-theme-grid', id); },
        setListStyle: (id) => {
            tempCustState.listStyle = id;
            if(id==='custom') { document.getElementById('custom-list-creator').classList.remove('hidden'); document.getElementById('btn-custom-list').classList.add('cust-active'); }
            else { document.getElementById('custom-list-creator').classList.add('hidden'); document.getElementById('btn-custom-list').classList.remove('cust-active'); }
            updateCustPreview(); renderSelection('list-style-grid', id);
        },
        saveCustomization: async () => {
            if(!currentUser) return;
            try {
                await updateDoc(doc(db, "users", currentUser.uid), {
                    usernameStyle: { color: tempCustState.color, font: tempCustState.font, effect: tempCustState.effect },
                    listStyle: tempCustState.listStyle,
                    customListStyle: tempCustState.customList,
                    messageStyle: { color: tempCustState.messageColor },
                    usercardStyle: tempCustState.cardTheme
                });
                const toast = document.createElement('div');
                toast.className = "bg-green-500 text-white px-4 py-2 rounded shadow-lg"; toast.innerText = "Saved!";
                document.getElementById('toast-container').appendChild(toast);
                setTimeout(()=>toast.remove(), 2000);
            } catch(e) { console.error(e); }
        }
    };

    function renderSelection(gridId, activeId) {
        Array.from(document.getElementById(gridId).children).forEach(btn => {
            if(btn.id === `btn-${activeId}`) btn.classList.add('cust-active'); else btn.classList.remove('cust-active');
        });
    }
</script>
</body>
</html>
